---
layout: post
title: Makefile的一些基本用法
categories: [Coding]
tags: [Makefile]
---

### 使用`.PHONY`来声明伪工作目标

```
.PHONY:clean
clean:
	rm -fr *.o target
```

以上创建了 `clean` 目录，用于清除生成的中间文件。

对于伪工作目标，`make` 不会试图建立以工作目标为名的文件。

一些标准的伪工作目标：

|名称|描述|
|-------|---------------------------------|
|all|执行编译应用程序的所有工作|
|install|从已经编译的二进制文件进行应用程序的安装|
|clean|将产生自源代码的二进制文件删除|
|distclean|删除编译过程中产生的任何文件|
|TAGS|建立可供编辑器使用的标记表|
|info|从Textinfo源代码来创建GNU info文件|
|check|执行与应用程序相关的测试|

### 自动变量

7个核心的自动变量:

|名称|描述|
|---------|-------------------------------|
|$@|工作目标的文件名|
|$%|archive文件名|
|$<|第一个必要条件的文件名|
|$?|时间戳在工作目标之后的所有必要条件|
|$^|所有必要条件的文件名|
|$+|也是所有必要条件的文件名，但是有重复|
|$*|工作目标的主文件名|

### `VPATH` 或者 `vpath` 来指定源文件路径

	VPATH = src

`VPATH` 里面可以放入目录列表

但是需要主要注意的是，make会为它需要的文件搜索每一个目录，如果多个目录出现同名的文件，则以第一个为主。

为避免重复，可以使用 `vpath` 指令：

```
vpath %.c src
vpath %.h include
```

以上告诉 `make` 从 `src` 中寻找 `.c` 文件，从 `include` 中寻找 `.h` 文件